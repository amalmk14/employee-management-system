<!DOCTYPE html>
<html>
<head>
  <title>Login, Signup & Profile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: auto; 
      padding: 20px; 
    }
    input, button { 
      display: block;
      width: 100%; 
      padding: 8px; 
      margin: 10px 0; 
    }
    button { 
      background-color: #333; 
      color: #fff; 
      border: none; 
      cursor: pointer; 
    }
    .section { 
      margin-bottom: 40px; 
    }
  </style>
</head>
<body>
  <div class="section">
    <h2>Login</h2>
    <input type="text" id="loginUsername" placeholder="Username">
    <input type="password" id="loginPassword" placeholder="Password">
    <button onclick="loginUser()">Login</button>
  </div>

  <div class="section">
    <h2>Signup</h2>
    <input type="text" id="signupUsername" placeholder="Username">
    <input type="email" id="signupEmail" placeholder="Email">
    <input type="password" id="signupPassword" placeholder="Password">
    <button onclick="signupUser()">Signup</button>
  </div>

  <div class="section" id="profileSection" style="display:none;">
    <h2>Profile</h2>
    <p><strong>Username:</strong> <span id="profileUsername"></span></p>
    <p><strong>Email:</strong> <span id="profileEmail"></span></p>
    <button onclick="loadProfile()">Refresh Profile</button>
  </div>

  <script>
    const API_BASE = '/api/accounts';

    function getToken() {
      return localStorage.getItem('access');
    }

    async function loginUser() {
      const response = await fetch(`${API_BASE}/login/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('loginUsername').value,
          password: document.getElementById('loginPassword').value
        })
      });
      const data = await response.json();
      if (data.access) {
        localStorage.setItem('access', data.access);
        alert('Login successful');
        document.getElementById('profileSection').style.display = 'block';
        loadProfile();
      } else {
        alert('Login failed');
      }
    }

    async function signupUser() {
      const response = await fetch(`${API_BASE}/register/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: document.getElementById('signupUsername').value,
          email: document.getElementById('signupEmail').value,
          password: document.getElementById('signupPassword').value
        })
      });
      if (response.ok) {
        alert('Signup successful');
      } else {
        alert('Signup failed');
      }
    }

    async function loadProfile() {
      const res = await fetch(`${API_BASE}/profile/`, {
        headers: { 'Authorization': `Bearer ${getToken()}` }
      });
      const data = await res.json();
      document.getElementById('profileUsername').textContent = data.username;
      document.getElementById('profileEmail').textContent = data.email;
    }
  </script>
</body>
</html>
