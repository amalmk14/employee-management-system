<!-- <!DOCTYPE html>
<html>
<head>
  <title>Form Builder</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, select, button { margin: 5px 0; padding: 8px; width: 100%; }
    .field-block { margin-bottom: 10px; background: #f1f1f1; padding: 10px; }
    .btn { padding: 8px 14px; background: #333; color: white; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Create Dynamic Form</h2>
  <input type="text" id="formName" placeholder="Enter Form Name">
  <div id="fields"></div>
  <button class="btn" onclick="addField()">Add Field</button>
  <button class="btn" onclick="saveForm()">Save Form</button>

  <script>
    const api = '/api/employees';

    function getToken() {
      return localStorage.getItem('access');
    }

    function setHeaders() {
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getToken()}`
      };
    }

    function addField() {
      const div = document.createElement('div');
      div.className = 'field-block';
      div.innerHTML = `
        <input placeholder="Label" class="label">
        <select class="type">
          <option value="text">Text</option>
          <option value="number">Number</option>
          <option value="date">Date</option>
          <option value="password">Password</option>
        </select>
        <button onclick="this.parentElement.remove()">Remove</button>
      `;
      document.getElementById('fields').appendChild(div);
    }

    async function saveForm() {
      const fields = [...document.querySelectorAll('.field-block')].map((el, i) => ({
        label: el.querySelector('.label').value,
        field_type: el.querySelector('.type').value,
        order: i
      }));
      await fetch(`${api}/forms/`, {
        method: 'POST',
        headers: setHeaders(),
        body: JSON.stringify({ name: formName.value, fields })
      });
      alert('Form saved!');
    }
  </script>
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
  <title>Form Builder</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, select, button { margin: 5px 0; padding: 8px; width: 100%; }
    .field-block { margin-bottom: 10px; background: #f1f1f1; padding: 10px; }
    .btn { padding: 8px 14px; background: #333; color: white; border: none; cursor: pointer; }
    .section { margin-top: 40px; }
  </style>
</head>
<body>
  <h2>Create Dynamic Form</h2>
  <input type="text" id="formName" placeholder="Enter Form Name">
  <div id="fields"></div>
  <button class="btn" onclick="addField()">Add Field</button>
  <button class="btn" onclick="saveForm()">Save Form</button>

  <div class="section">
    <h2>Create Employee</h2>
    <select id="formSelector" onchange="loadEmployeeForm()"></select>
    <div id="employeeForm"></div>
    <button class="btn" onclick="submitEmployee()">Save Employee</button>
  </div>

  <script>
    const api = '/api/employees';

    function getToken() {
      return localStorage.getItem('access');
    }

    function setHeaders() {
      return {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${getToken()}`
      };
    }

    function addField() {
      const div = document.createElement('div');
      div.className = 'field-block';
      div.innerHTML = `
        <input placeholder="Label" class="label">
        <select class="type">
          <option value="text">Text</option>
          <option value="number">Number</option>
          <option value="date">Date</option>
          <option value="password">Password</option>
        </select>
        <button onclick="this.parentElement.remove()">Remove</button>
      `;
      document.getElementById('fields').appendChild(div);
    }

    async function saveForm() {
      const fields = [...document.querySelectorAll('.field-block')].map((el, i) => ({
        label: el.querySelector('.label').value,
        field_type: el.querySelector('.type').value,
        order: i
      }));
      await fetch(`${api}/forms/`, {
        method: 'POST',
        headers: setHeaders(),
        body: JSON.stringify({ name: formName.value, fields })
      });
      alert('Form saved!');
      loadForms();
    }

    async function loadForms() {
      const res = await fetch(`${api}/forms/`, { headers: setHeaders() });
      const forms = await res.json();
      const selector = document.getElementById('formSelector');
      selector.innerHTML = '';
      forms.forEach(form => {
        const option = document.createElement('option');
        option.value = form.id;
        option.textContent = form.name;
        selector.appendChild(option);
      });
      if (forms.length) loadEmployeeForm();
    }

    async function loadEmployeeForm() {
      const formId = document.getElementById('formSelector').value;
      const res = await fetch(`${api}/forms/${formId}/`, { headers: setHeaders() });
      const form = await res.json();
      const container = document.getElementById('employeeForm');
      container.innerHTML = '';
      container.dataset.formId = form.id;
      form.fields.forEach(field => {
        const input = document.createElement('input');
        input.placeholder = field.label;
        input.type = field.field_type;
        input.name = field.label;
        container.appendChild(input);
      });
    }

    async function submitEmployee() {
      const container = document.getElementById('employeeForm');
      const formId = container.dataset.formId;
      const inputs = container.querySelectorAll('input');
      const data = {};
      inputs.forEach(input => data[input.name] = input.value);
      await fetch(`${api}/employees/`, {
        method: 'POST',
        headers: setHeaders(),
        body: JSON.stringify({ form: formId, data })
      });
      alert('Employee saved!');
    }

    loadForms();
  </script>
</body>
</html>
